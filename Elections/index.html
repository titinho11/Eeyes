<!DOCTYPE html>
<html lang='en'>
    <head>
        <!-- META SECTION -->
        <title>Election's Eyes</title>            
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <link rel="icon" href="favicon.ico" type="image/x-icon" />
        <!-- END META SECTION -->

        <!-- CSS INCLUDE -->        
        <link rel="stylesheet" type="text/css" id="theme" href="css/theme-default.css"/>
        <!-- EOF CSS INCLUDE -->  
        
    </head>
    <body>
        <!-- START PAGE CONTAINER -->
        <div class="page-container">
            
            <!-- START PAGE SIDEBAR -->
            <div class="page-sidebar" id="sidebar">
                <!-- START X-NAVIGATION -->
                <ul class="x-navigation">
                        <li class="xn-logo">
                            <a href="index.html">Election's<span class="fa fa-eye"></span></a>
                            <a href="#" class="x-navigation-control"></a>
                        </li>
                        <li class="xn-title">Navigation</li>
                        <li class="active">
                            <a href="index.php"><span class="fa fa-desktop"></span> <span class="xn-text">Accueil</span></a>                        
                        </li>                    
                        <li class="lien">
                            <a href="Bureau_vote.html"><span class="fa fa-th"></span> <span class="xn-text">Sections</span></a>
                        </li>
                        <li class="xn-title">Informations</li>                  
                        <li>
                            <a href="#"><span class="fa fa-question-circle"></span> <span class="xn-text">Aide</span></a>
                        </li> 
                        <li>
                                <a href="#"><span class="fa fa-info"></span> <span class="xn-text">A Propos</span></a>
                        </li>                   
                    </ul>
                
                    
                    <!-- END X-NAVIGATION -->
            </div>
            <!-- END PAGE SIDEBAR -->
            
            <!-- PAGE CONTENT -->
            <div class="page-content">
                <div id="sup_nav"></div>
                <!-- START X-NAVIGATION VERTICAL -->
                <ul class="x-navigation x-navigation-horizontal x-navigation-panel">
                        <!-- TOGGLE NAVIGATION -->
                        <li class="xn-icon-button">
                            <a href="#" class="x-navigation-minimize"><span class="fa fa-dedent"></span></a>
                        </li>
                        <!-- END TOGGLE NAVIGATION -->
                        <!-- SEARCH -->
                         
                        <!-- END SEARCH -->
                        <!-- MESSAGES -->
                        <li class="xn-icon-button pull-right">
                            <a href="#"><span class="fa fa-upload"></span></a>
                            <div class="panel panel-primary animated zoomIn xn-drop-left xn-panel-dragging">
                                <div class="panel-heading">
                                    <h3 class="panel-title"><span class="fa fa-upload"></span>Upload PV</h3>                                
                                </div>
                                <div class="panel-body" style="height: 400px;">
                                        <h3><span class="fa fa-mail-forward"></span> Upload le PV d'un Bureau</h3>
                                        <p>Add class to file input to get Bootstrap FileInput plugin</p>                                    
                                        <form enctype="multipart/form-data" class="form-horizontal" onsubmit="return send()">                                        
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label>Default</label>
                                                    <input type="file" id="pv" class="file" data-preview-file-type="any"/>
                                                </div>
                                            </div>
                                        </form>
                                </div>                               
                            </div>                        
                        </li>
                        <!-- END MESSAGES -->
                    </ul>
                    <!-- END X-NAVIGATION VERTICAL -->                      
                <div id="page_content">
                <!-- START BREADCRUMB -->
                <ul class="breadcrumb">
                    <li><a href="#">Accueil</a></li>                    
                    <li class="active">index</li>
                </ul>
                    <!-- END BREADCRUMB -->  
                <!-- PAGE CONTENT WRAPPER -->
                <div class="page-content-wrap">
                                    
                        <!-- START WIDGETS -->                    
                        <div class="row">
                            <div class="col-md-3">
                                
                                <!-- START WIDGET MESSAGES -->
                                <div class="widget widget-default widget-item-icon">
                                    <div class="widget-item-left">
                                        <span class="fa fa-envelope"></span>
                                    </div>                             
                                    <div class="widget-data">
                                        <div class="widget-int num-count" id = "pv_recu"></div>
                                        <div class="widget-title">PVs</div>
                                        <div class="widget-subtitle">Attendus</div>
                                    </div>      
                                    <div class="widget-controls">                                
                                        <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="top" title="Remove Widget"><span class="fa fa-times"></span></a>
                                    </div>
                                </div>                            
                                <!-- END WIDGET MESSAGES -->
                                
                            </div>
                            <div class="col-md-3">
                                
                                <!-- START WIDGET REGISTRED -->
                                <div class="widget widget-default widget-item-icon" >
                                    <div class="widget-item-left">
                                        <span class="fa fa-user"></span>
                                    </div>
                                    <div class="widget-data">
                                        <div class="widget-int num-count" id="pv_attendu"></div>
                                        <div class="widget-title">Pvs</div>
                                        <div class="widget-subtitle">Recus</div>
                                    </div>
                                    <div class="widget-controls">                                
                                        <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="top" title="Remove Widget"><span class="fa fa-times"></span></a>
                                    </div>                            
                                </div>                            
                                <!-- END WIDGET REGISTRED -->
                                
                            </div>
                            <div class="col-md-3">
                                
                                    <!-- START WIDGET MESSAGES -->
                                    <div class="widget widget-default widget-item-icon">
                                        <div class="widget-item-left">
                                            <span class="fa fa-envelope"></span>
                                        </div>                             
                                        <div class="widget-data">
                                            <div class="widget-int num-count" id="voix"></div>
                                            <div class="widget-title">Suffrages</div>
                                            <div class="widget-subtitle">Exprimés</div>
                                        </div>      
                                        <div class="widget-controls">                                
                                            <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="top" title="Remove Widget"><span class="fa fa-times"></span></a>
                                        </div>
                                    </div>                            
                                    <!-- END WIDGET MESSAGES -->
                                    
                                </div>
                            <div class="col-md-3">
                                
                                <!-- START WIDGET CLOCK -->
                                <div class="widget widget-info widget-padding-sm">
                                    <div class="widget-big-int plugin-clock">00:00</div>                            
                                    <div class="widget-subtitle plugin-date">Loading...</div>
                                    <div class="widget-controls">                                
                                        <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="left" title="Remove Widget"><span class="fa fa-times"></span></a>
                                    </div>                            
                                    <div class="widget-buttons widget-c3">
                                        <div class="col">
                                            <a href="#"><span class="fa fa-clock-o"></span></a>
                                        </div>
                                        <div class="col">
                                            <a href="#"><span class="fa fa-bell"></span></a>
                                        </div>
                                        <div class="col">
                                            <a href="#"><span class="fa fa-calendar"></span></a>
                                        </div>
                                    </div>                            
                                </div>                        
                                <!-- END WIDGET CLOCK -->
                                
                            </div>
                        </div>
                        <!-- END WIDGETS -->                    
                        
                        <div class="row">
                            <div class="col-md-8">
                                
                                <!-- START USERS ACTIVITY BLOCK -->
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <div class="panel-title-box">
                                            <h3>Resultats</h3>
                                            <span>Graphe des résultats finaux</span>
                                        </div>                                    
                                        <ul class="panel-controls" style="margin-top: 2px;">
                                            <li><a href="#" class="panel-fullscreen"><span class="fa fa-expand"></span></a></li>
                                            <li><a href="#" class="panel-refresh"><span class="fa fa-refresh"></span></a></li>
                                            <li class="dropdown">
                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="fa fa-cog"></span></a>                                        
                                                <ul class="dropdown-menu">
                                                    <li><a href="#" class="panel-collapse"><span class="fa fa-angle-down"></span> Collapse</a></li>
                                                    <li><a href="#" class="panel-remove"><span class="fa fa-times"></span> Remove</a></li>
                                                </ul>                                        
                                            </li>                                        
                                        </ul>                                    
                                    </div>                                
                                    <div class="panel-body padding-0">
                                        <div class="chart-holder" id="dashboard-bar-2" style="height: 200px;"></div>
                                    </div>
                                    <div class="panel-body padding-0">
                                        <div class="chart-holder" id="dashboard-bar-1" style="height: 0px;"></div>
                                    </div>                                    
                                </div>
                                <!-- END USERS ACTIVITY BLOCK -->
                                
                            </div>
                            <div class="col-md-4">
                                
                                <!-- START VISITORS BLOCK -->
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <div class="panel-title-box">
                                            <h3>Resultats Finaux</h3>
                                            <span>Vrai Resultats</span>
                                        </div>
                                        <ul class="panel-controls" style="margin-top: 2px;">
                                            <li><a href="#" class="panel-fullscreen"><span class="fa fa-expand"></span></a></li>
                                            <li><a href="#" class="panel-refresh"><span class="fa fa-refresh"></span></a></li>
                                            <li class="dropdown">
                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="fa fa-cog"></span></a>                                        
                                                <ul class="dropdown-menu">
                                                    <li><a href="#" class="panel-collapse"><span class="fa fa-angle-down"></span> Collapse</a></li>
                                                    <li><a href="#" class="panel-remove"><span class="fa fa-times"></span> Remove</a></li>
                                                </ul>                                        
                                            </li>                                        
                                        </ul>
                                    </div>
                                    <div class="panel-body padding-0">
                                        <div class="chart-holder" id="dashboard-donut-2" style="height: 200px;"></div>
                                    </div>
                                    <div class="panel-body padding-0">
                                        <div class="chart-holder" id="dashboard-donut-1" style="height: 0px;"></div>
                                    </div>
                                </div>
                                <!-- END VISITORS BLOCK -->
                                
                            </div>

                        </div>
                        
                 
                        
                        <!-- START DASHBOARD CHART -->
                        <div class="chart-holder" id="dashboard-area-1" style="height: 0px;"></div>
                        <div class="block-full-width">
                                                                        
                        </div>                    
                        <!-- END DASHBOARD CHART -->
                        
                </div>
                    <!-- END PAGE CONTENT WRAPPER --> 
                                    
            </div>            
            <!-- END PAGE CONTENT -->
        </div>
        <!-- END PAGE CONTAINER -->

        <!-- START PRELOADS -->
        <audio id="audio-alert" src="audio/alert.mp3" preload="auto"></audio>
        <audio id="audio-fail" src="audio/fail.mp3" preload="auto"></audio>
        <!-- END PRELOADS -->  
        <div id="scripts"></div>  
    </body>
    
    <!-- START SCRIPTS -->
        <!-- START PLUGINS -->
        <script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="js/plugins/jquery/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/plugins/bootstrap/bootstrap.min.js"></script>        
        <!-- END PLUGINS -->

        <!-- START THIS PAGE PLUGINS-->        
        <script type='text/javascript' src='js/plugins/icheck/icheck.min.js'></script>        
        <script type="text/javascript" src="js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js"></script>
        <script type="text/javascript" src="js/plugins/scrolltotop/scrolltopcontrol.js"></script>
        
        <script type="text/javascript" src="js/plugins/morris/raphael-min.js"></script>
        <script type="text/javascript" src="js/plugins/morris/morris.min.js"></script>       
        <script type="text/javascript" src="js/plugins/rickshaw/d3.v3.js"></script>
        <script type="text/javascript" src="js/plugins/rickshaw/rickshaw.min.js"></script>
        <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js'></script>
        <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js'></script>                
        <script type='text/javascript' src='js/plugins/bootstrap/bootstrap-datepicker.js'></script>                
        <script type="text/javascript" src="js/plugins/owl/owl.carousel.min.js"></script>                 
        
        <script type="text/javascript" src="js/plugins/moment.min.js"></script>
        <script type="text/javascript" src="js/plugins/daterangepicker/daterangepicker.js"></script>
        <!-- END THIS PAGE PLUGINS-->   
        
        <!--Burau de vote scripts-->
        <script type="text/javascript" src="js/plugins/bootstrap/bootstrap-timepicker.min.js"></script>
        <script type="text/javascript" src="js/plugins/bootstrap/bootstrap-colorpicker.js"></script>
        <script type="text/javascript" src="js/plugins/bootstrap/bootstrap-file-input.js"></script>
        <script type="text/javascript" src="js/plugins/bootstrap/bootstrap-select.js"></script>
        <script type="text/javascript" src="js/plugins/tagsinput/jquery.tagsinput.min.js"></script>
        <script type="text/javascript" src="js/plugins/sparkline/jquery.sparkline.min.js"></script>
        <script type="text/javascript" src="js/plugins/knob/jquery.knob.min.js"></script>
        <script type="text/javascript" src="js/plugins/fileinput/fileinput.min.js"></script> 
            

        <!--Bureau de vote scripts-->

        <!-- START TEMPLATE -->
        <script type="text/javascript" src="js/settings.js"></script>
        
        <script type="text/javascript" src="js/plugins.js"></script>        
        <script type="text/javascript" src="js/actions.js"></script>
        
        <script type="text/javascript" src="js/demo_dashboard.js"></script>
         
        <!-- END TEMPLATE -->
    <!-- END SCRIPTS --> 
    <script type="text/javascript" src="js/variable.js"></script> 
    <script type="text/javascript" src="js/lecturePV.js"></script> 
    <script type="text/javascript" src="js/ocr/ocrad.js"></script> 

    <script>
       
            //variable qui contient l'image sous le format base64
            var picture = "";
     
             var allowedTypes = ['png', 'jpg', 'jpeg', 'gif'];
             var fileInput = document.querySelector('#pv');
     
     
             //Méthode appelé une fois qu'un fichier est selectionné
             document.querySelector('#pv').addEventListener('change', function() {
     
                 imgType = fileInput.files[0].name.split('.');
     
                 imgType = imgType[imgType.length - 1].toLowerCase(); // On utilise toLowerCase() pour éviter les extensions en majuscules
     
                 //On vérifie si le fichier selectionné est dans le bon format
                 if (allowedTypes.indexOf(imgType) != -1) {
     
                    var reader = new FileReader();
					reader.onload = function(){
						var img = new Image();
						img.src = reader.result;
						img.onload = function(){
							/*document.getElementById('nose').innerHTML = ''
							document.getElementById('nose').appendChild(img)*/
							OCRAD(img, function(text){
								/*document.getElementById('transcription').className = "done"
								document.getElementById('transcription').innerText = text;*/
								scrutateur = "Paul Biya"
								table = text.split('\n')
								console.log("****************")
								console.log(table)
								final = new Array();
								for (i=0; i<table.length; i++){
									if(!(table[i]==''||table[i]==' '||table[i]=='---')){
										final.push(table[i]);
									}
								}
								console.log(final);
								variable = {};
								variable["$class"] = "org.eeyes.ressources.ComputePV";
								variable["code"] = final[0].substring(8, final[0].length).replace(/-l/g,'-1')+":"+scrutateur;
								variable["BV"] = final[1].substring(15, final[1].length).replace(/-l/g,'-1');
								variable["sectionName"] = final[0].substring(8, final[0].length).replace(/-l/g,'-1');
								variable["nombreElecteursInscrits"] = parseInt(final[2].split(' ')[2]);
								variable["nombreSuffrageEmi"] = parseInt(final[3].split(' ')[3]);
								var today = new Date();
								var dd = today.getDate();
								var mm = today.getMonth()+1;
								var yyyy = today.getFullYear();

								if(dd<10) {
									dd = '0'+dd
								}

								if(mm<10) {
									mm = '0'+mm
								}

								var hour =  today.getHours();
								if(hour<10) {
									hour = '0'+hour
								}
								var minute = today.getMinutes();
								if(minute<10) {
									minute = '0'+minute
								}
								var second = today.getSeconds();
								if(second<10) {
									second = '0'+second
								}

								today = yyyy + '-' + mm + '-' + dd + 'T' + hour + ':' + minute + ':' + second;

								variable["publishedDate"] = today;
								variable["candidateVoices"] = new Array();

								for (i=5;i<final.length;i++){
									voice_temp = {};
									voice_temp["$class"] = "org.eeyes.ressources.Voices";
									tab_temp = final[i].split(" ");
									voice_temp["candidate"] = "";
									for (j=0; j<tab_temp.length-2;j++){
										voice_temp["candidate"] = voice_temp["candidate"]+tab_temp[j]+" ";
									}
									voice_temp["candidate"] = voice_temp["candidate"]+tab_temp[j];
									j = j+1;
									voice_temp["voice"] = parseInt(tab_temp[j].replace(/o/,'0').replace(/l/g,'1'));
									variable["candidateVoices"].push(voice_temp);
								}
								variable["scrutateur"] = "resource:org.eeyes.ressources.Author#"+scrutateur;

								console.log(variable);
								send(variable);
							})
						}
					}
					//reader.readAsDataURL(document.getElementById('picker').files[0])
                     
                     //évènement qui se déclenche une fois que le fichié est uploadé
                     /*reader.addEventListener('load', function() {
                         picture = reader.result;
                     });*/
                     //lecture du fichier en tant que base64
                     reader.readAsDataURL(fileInput.files[0]);
                     //alert(picture);
     
                 }else{
                     alert("Vous devez selectionner une image dans l'un des formats : png, jpg, jpeg, gif");
                 }
     
     
             });
     
             //Fonction permettant d'envoyer l'image au format base64 sur le le reseau
             function send(datas) {
                
                 //On vériifie si l'utilisateur a selectionné le fichier dans le bon format
                console.log("ici datas fonction send", datas);
                $.ajax({
                    type: "POST",
                    url: "http://localhost:3000/api/ComputePV",
                    data: datas,
                    success: function(result){alert("Success");},
                    error: function(e,r,s){console.log(e);}
                });
     
             }
     
         </script>
    
</html> 
